# üîß ESPECIFICA√á√ÉO T√âCNICA ‚Äî Sistema de Gest√£o de Prioridades (v1.0)

## 1. Vis√£o Geral T√©cnica

### 1.1 Stack Tecnol√≥gica

- **Backend**: NestJS + TypeScript
- **Banco de Dados**: Firestore (Google Cloud)
- **IA**: Vertex AI (Gemini 2.0) via LangGraph
- **Formato de Comunica√ß√£o com IA**: TOON (@toon-format/toon)
- **Autentica√ß√£o**: JWT (Google OAuth)
- **Arquitetura**: Clean Architecture + Hexagonal

### 1.2 Estrutura de Camadas

```
domain/          ‚Üí Entidades e interfaces (Prioridade, Tarefa)
application/     ‚Üí Use Cases e DTOs
infrastructure/  ‚Üí Implementa√ß√µes (Firestore, Vertex AI)
presentation/    ‚Üí Controllers REST
```

---

## 2. Entidades de Dom√≠nio

### 2.1 Prioridade

```typescript
enum EisenhowerQuadrant {
  Q1 = 'Q1', // Urgente / Importante
  Q2 = 'Q2', // N√£o urgente / Importante
  Q3 = 'Q3', // Urgente / N√£o importante
  Q4 = 'Q4', // N√£o urgente / N√£o importante
}

enum PriorityStatus {
  ACTIVE = 'active',
  COMPLETED = 'completed',
  ARCHIVED = 'archived',
}

enum PriorityOrigin {
  MANUAL = 'manual',
  AI = 'ai',
}

class Prioridade extends BaseEntity {
  userId: string;
  title: string;
  description?: string;
  quadrant: EisenhowerQuadrant;
  tags: string[];
  status: PriorityStatus;
  origin: PriorityOrigin;
  displayOrder: number; // Ordem dentro do quadrante
}
```

### 2.2 Tarefa

```typescript
enum TaskClassification {
  DO = 'do',           // Fazer
  SCHEDULE = 'schedule', // Agendar
  DELEGATE = 'delegate', // Delegar
  ELIMINATE = 'eliminate', // Eliminar
}

enum TaskStatus {
  OPEN = 'open',
  IN_PROGRESS = 'in_progress',
  COMPLETED = 'completed',
  CANCELLED = 'cancelled',
}

enum TaskOrigin {
  MANUAL = 'manual',
  AI = 'ai',
}

class Tarefa extends BaseEntity {
  userId: string;
  priorityId: string; // Obrigat√≥rio
  title: string;
  description?: string;
  classification: TaskClassification;
  idealDate?: Date; // Para tarefas Agendar
  responsible?: string; // Para tarefas Delegar (texto livre)
  status: TaskStatus;
  origin: TaskOrigin;
  meetingReference?: string; // ID/nome da reuni√£o (quando criada via Inbox)
}
```

### 2.3 Inbox Item

```typescript
enum InboxItemStatus {
  PENDING = 'pending',     // Aguardando processamento
  PROCESSED = 'processed', // Processado pela IA
  ACCEPTED = 'accepted',   // Aceito pelo usu√°rio
  DISCARDED = 'discarded', // Descartado
}

class InboxItem extends BaseEntity {
  userId: string;
  meetingTitle?: string;
  meetingContent: string; // Resumo da reuni√£o
  status: InboxItemStatus;
  suggestions: ActionSuggestion[]; // Sugest√µes da IA
  processedAt?: Date;
}

class ActionSuggestion {
  id: string; // ID tempor√°rio para refer√™ncia
  relevantText?: string; // Trecho do resumo
  actionSummary: string; // Resumo da a√ß√£o sugerida
  suggestedPriority: {
    title: string;
    quadrant: EisenhowerQuadrant;
    tags: string[];
  };
  suggestedTask: {
    title: string;
    classification: TaskClassification;
    idealDate?: Date;
    responsible?: string;
  };
  meetingReference: string; // T√≠tulo da reuni√£o
}
```

---

## 3. Endpoints REST

### 3.1 Prioridades

#### `GET /priorities`
Lista todas as prioridades do usu√°rio autenticado.

**Query Parameters:**
- `status?: PriorityStatus` - Filtrar por status
- `quadrant?: EisenhowerQuadrant` - Filtrar por quadrante
- `tags?: string[]` - Filtrar por tags (separadas por v√≠rgula)
- `origin?: PriorityOrigin` - Filtrar por origem

**Response:**
```typescript
{
  priorities: PriorityResponseDto[];
}
```

#### `GET /priorities/:id`
Obt√©m uma prioridade espec√≠fica.

**Response:**
```typescript
PriorityResponseDto
```

#### `POST /priorities`
Cria uma nova prioridade.

**Request Body:**
```typescript
{
  title: string;
  description?: string;
  quadrant: EisenhowerQuadrant;
  tags?: string[];
  origin?: PriorityOrigin; // Default: 'manual'
}
```

**Response:**
```typescript
PriorityResponseDto
```

#### `PATCH /priorities/:id`
Atualiza uma prioridade existente.

**Request Body:**
```typescript
{
  title?: string;
  description?: string;
  quadrant?: EisenhowerQuadrant;
  tags?: string[];
  status?: PriorityStatus;
}
```

**Response:**
```typescript
PriorityResponseDto
```

#### `POST /priorities/:id/move`
Move uma prioridade para outro quadrante e/ou atualiza ordem.

**Request Body:**
```typescript
{
  quadrant: EisenhowerQuadrant;
  displayOrder?: number; // Nova posi√ß√£o no quadrante
}
```

**Response:**
```typescript
PriorityResponseDto
```

#### `POST /priorities/:id/reorder`
Reordena prioridades dentro de um quadrante.

**Request Body:**
```typescript
{
  priorityIds: string[]; // IDs na nova ordem
}
```

**Response:**
```typescript
{
  success: boolean;
}
```

#### `POST /priorities/:id/archive`
Arquiva uma prioridade.

**Response:**
```typescript
PriorityResponseDto
```

#### `DELETE /priorities/:id`
Exclui permanentemente uma prioridade (exige confirma√ß√£o no frontend).

**Response:**
```typescript
{
  success: boolean;
}
```

### 3.2 Tarefas

#### `GET /priorities/:priorityId/tasks`
Lista todas as tarefas de uma prioridade.

**Query Parameters:**
- `classification?: TaskClassification` - Filtrar por classifica√ß√£o
- `status?: TaskStatus` - Filtrar por status

**Response:**
```typescript
{
  tasks: TaskResponseDto[];
}
```

#### `GET /tasks/:id`
Obt√©m uma tarefa espec√≠fica.

**Response:**
```typescript
TaskResponseDto
```

#### `POST /priorities/:priorityId/tasks`
Cria uma nova tarefa vinculada a uma prioridade.

**Request Body:**
```typescript
{
  title: string;
  description?: string;
  classification: TaskClassification;
  idealDate?: Date; // Obrigat√≥rio se classification = 'schedule'
  responsible?: string; // Obrigat√≥rio se classification = 'delegate'
  origin?: TaskOrigin; // Default: 'manual'
  meetingReference?: string;
}
```

**Response:**
```typescript
TaskResponseDto
```

#### `PATCH /tasks/:id`
Atualiza uma tarefa existente.

**Request Body:**
```typescript
{
  title?: string;
  description?: string;
  classification?: TaskClassification;
  idealDate?: Date;
  responsible?: string;
  status?: TaskStatus;
}
```

**Response:**
```typescript
TaskResponseDto
```

#### `POST /tasks/:id/move`
Move uma tarefa para outra classifica√ß√£o.

**Request Body:**
```typescript
{
  classification: TaskClassification;
  idealDate?: Date; // Se mudar para 'schedule'
  responsible?: string; // Se mudar para 'delegate'
}
```

**Response:**
```typescript
TaskResponseDto
```

#### `POST /tasks/:id/complete`
Marca uma tarefa como conclu√≠da.

**Response:**
```typescript
TaskResponseDto
```

#### `POST /tasks/:id/cancel`
Cancela uma tarefa.

**Response:**
```typescript
TaskResponseDto
```

#### `DELETE /tasks/:id`
Exclui permanentemente uma tarefa.

**Response:**
```typescript
{
  success: boolean;
}
```

### 3.3 Inbox

#### `GET /inbox`
Lista todos os itens da inbox do usu√°rio.

**Query Parameters:**
- `status?: InboxItemStatus` - Filtrar por status

**Response:**
```typescript
{
  items: InboxItemResponseDto[];
}
```

#### `GET /inbox/:id`
Obt√©m um item espec√≠fico da inbox com suas sugest√µes.

**Response:**
```typescript
InboxItemResponseDto
```

#### `POST /inbox/process`
Processa um resumo de reuni√£o e gera sugest√µes de a√ß√µes.

**Request Body:**
```typescript
{
  meetingTitle?: string;
  meetingContent: string; // Resumo da reuni√£o
}
```

**Response:**
```typescript
{
  inboxItemId: string;
  suggestions: ActionSuggestion[];
}
```

#### `POST /inbox/:id/accept`
Aceita uma sugest√£o e cria prioridade/tarefa.

**Request Body:**
```typescript
{
  suggestionId: string;
  adjustments?: {
    priority?: {
      title?: string;
      quadrant?: EisenhowerQuadrant;
      tags?: string[];
    };
    task?: {
      title?: string;
      classification?: TaskClassification;
      idealDate?: Date;
      responsible?: string;
    };
  };
  linkToExistingPriorityId?: string; // Se quiser vincular a prioridade existente
}
```

**Response:**
```typescript
{
  priority: PriorityResponseDto;
  task: TaskResponseDto;
}
```

#### `POST /inbox/:id/discard`
Descarta uma sugest√£o.

**Request Body:**
```typescript
{
  suggestionId: string;
}
```

**Response:**
```typescript
{
  success: boolean;
}
```

#### `DELETE /inbox/:id`
Remove um item da inbox.

**Response:**
```typescript
{
  success: boolean;
}
```

### 3.4 Chat com IA (Extens√£o)

#### `POST /ai/chat`
Chat existente, mas agora com capacidade de criar/editar prioridades e tarefas.

**Nota:** A comunica√ß√£o com a IA utiliza formato TOON para efici√™ncia em tokens. O backend converte automaticamente entre TOON e JSON.

**Request Body:**
```typescript
{
  conversationId: string;
  message: string;
  context?: {
    priorities?: PriorityResponseDto[];
    tasks?: TaskResponseDto[];
  };
}
```

**Response:**
```typescript
{
  response: string; // Resposta em texto natural
  actions?: {
    type: 'create_priority' | 'create_task' | 'update_priority' | 'update_task' | 'move_priority' | 'move_task';
    data: any; // Dados decodificados do TOON retornado pela IA
  }[];
}
```

### 3.5 Relat√≥rios

#### `GET /reports/daily`
Relat√≥rio di√°rio.

**Response:**
```typescript
{
  date: string;
  prioritiesByQuadrant: {
    Q1: number;
    Q2: number;
    Q3: number;
    Q4: number;
  };
  openTasks: number;
  completedTasksToday: number;
}
```

#### `GET /reports/weekly`
Relat√≥rio semanal.

**Query Parameters:**
- `weekStart?: string` - Data de in√≠cio da semana (ISO format)

**Response:**
```typescript
{
  weekStart: string;
  weekEnd: string;
  completedTasksByClassification: {
    do: number;
    schedule: number;
    delegate: number;
    eliminate: number;
  };
  actionsByOrigin: {
    manual: number;
    ai: number;
  };
}
```

---

## 4. DTOs (Data Transfer Objects)

### 4.1 Prioridade

```typescript
// Request DTOs
class CreatePriorityDto {
  title: string;
  description?: string;
  quadrant: EisenhowerQuadrant;
  tags?: string[];
  origin?: PriorityOrigin;
}

class UpdatePriorityDto {
  title?: string;
  description?: string;
  quadrant?: EisenhowerQuadrant;
  tags?: string[];
  status?: PriorityStatus;
}

class MovePriorityDto {
  quadrant: EisenhowerQuadrant;
  displayOrder?: number;
}

class ReorderPrioritiesDto {
  priorityIds: string[];
}

// Response DTO
class PriorityResponseDto {
  id: string;
  userId: string;
  title: string;
  description?: string;
  quadrant: EisenhowerQuadrant;
  tags: string[];
  status: PriorityStatus;
  origin: PriorityOrigin;
  displayOrder: number;
  taskCount?: number; // Contador de tarefas abertas
  createdAt: Date;
  updatedAt: Date;
}
```

### 4.2 Tarefa

```typescript
// Request DTOs
class CreateTaskDto {
  title: string;
  description?: string;
  classification: TaskClassification;
  idealDate?: Date;
  responsible?: string;
  origin?: TaskOrigin;
  meetingReference?: string;
}

class UpdateTaskDto {
  title?: string;
  description?: string;
  classification?: TaskClassification;
  idealDate?: Date;
  responsible?: string;
  status?: TaskStatus;
}

class MoveTaskDto {
  classification: TaskClassification;
  idealDate?: Date;
  responsible?: string;
}

// Response DTO
class TaskResponseDto {
  id: string;
  userId: string;
  priorityId: string;
  title: string;
  description?: string;
  classification: TaskClassification;
  idealDate?: Date;
  responsible?: string;
  status: TaskStatus;
  origin: TaskOrigin;
  meetingReference?: string;
  createdAt: Date;
  updatedAt: Date;
}
```

### 4.3 Inbox

```typescript
// Request DTOs
class ProcessInboxDto {
  meetingTitle?: string;
  meetingContent: string;
}

class AcceptSuggestionDto {
  suggestionId: string;
  adjustments?: {
    priority?: {
      title?: string;
      quadrant?: EisenhowerQuadrant;
      tags?: string[];
    };
    task?: {
      title?: string;
      classification?: TaskClassification;
      idealDate?: Date;
      responsible?: string;
    };
  };
  linkToExistingPriorityId?: string;
}

class DiscardSuggestionDto {
  suggestionId: string;
}

// Response DTOs
class ActionSuggestionDto {
  id: string;
  relevantText?: string;
  actionSummary: string;
  suggestedPriority: {
    title: string;
    quadrant: EisenhowerQuadrant;
    tags: string[];
  };
  suggestedTask: {
    title: string;
    classification: TaskClassification;
    idealDate?: Date;
    responsible?: string;
  };
  meetingReference: string;
}

class InboxItemResponseDto {
  id: string;
  userId: string;
  meetingTitle?: string;
  meetingContent: string;
  status: InboxItemStatus;
  suggestions: ActionSuggestionDto[];
  processedAt?: Date;
  createdAt: Date;
  updatedAt: Date;
}
```

---

## 5. Fluxos T√©cnicos Principais

### 5.1 Cria√ß√£o de Prioridade via Chat

1. Usu√°rio envia mensagem no chat: "Crie uma prioridade urgente e importante chamada 'Fechar proposta'"
2. `ChatUseCase` processa a mensagem com Vertex AI (formato TOON)
3. Vertex AI identifica inten√ß√£o de criar prioridade e retorna dados em TOON
4. `ChatUseCase` decodifica resposta TOON e chama `CreatePriorityUseCase`
5. Prioridade √© criada no Firestore
6. Resposta do chat confirma cria√ß√£o
7. Frontend atualiza interface (matriz de prioridades)

### 5.2 Processamento de Inbox

1. Usu√°rio envia resumo de reuni√£o via `POST /inbox/process`
2. `ProcessInboxUseCase` cria `InboxItem` com status `PENDING`
3. `ProcessInboxUseCase` chama servi√ßo de IA com prompt espec√≠fico (formato TOON)
4. IA analisa resumo e retorna sugest√µes em formato TOON
5. `ProcessInboxUseCase` decodifica TOON para `ActionSuggestion[]`
6. `InboxItem` √© atualizado com sugest√µes e status `PROCESSED`
7. Frontend exibe sugest√µes para revis√£o do usu√°rio
8. Usu√°rio aceita/ajusta/descarta cada sugest√£o
9. Ao aceitar, `AcceptSuggestionUseCase` cria `Prioridade` e `Tarefa`

### 5.3 Reprioriza√ß√£o via Drag-and-Drop

1. Usu√°rio arrasta card de prioridade para outro quadrante
2. Frontend chama `POST /priorities/:id/move`
3. `MovePriorityUseCase` atualiza `quadrant` e `displayOrder`
4. Se necess√°rio, `MovePriorityUseCase` reordena outras prioridades
5. Firestore atualiza documentos
6. Frontend atualiza matriz

### 5.4 Mover Tarefa entre Classifica√ß√µes

1. Usu√°rio arrasta tarefa de "Fazer" para "Delegar"
2. Frontend solicita respons√°vel (se necess√°rio)
3. Frontend chama `POST /tasks/:id/move`
4. `MoveTaskUseCase` valida campos obrigat√≥rios (ex.: `responsible` para Delegar)
5. `MoveTaskUseCase` atualiza `classification` e campos relacionados
6. Firestore atualiza documento
7. Frontend atualiza visualiza√ß√£o

---

## 6. Estrutura no Firestore

### 6.1 Cole√ß√µes

```
users/{userId}
  - Dados do usu√°rio

priorities/{priorityId}
  - userId: string
  - title: string
  - description?: string
  - quadrant: string (Q1, Q2, Q3, Q4)
  - tags: string[]
  - status: string (active, completed, archived)
  - origin: string (manual, ai)
  - displayOrder: number
  - createdAt: Timestamp
  - updatedAt: Timestamp

tasks/{taskId}
  - userId: string
  - priorityId: string
  - title: string
  - description?: string
  - classification: string (do, schedule, delegate, eliminate)
  - idealDate?: Timestamp
  - responsible?: string
  - status: string (open, in_progress, completed, cancelled)
  - origin: string (manual, ai)
  - meetingReference?: string
  - createdAt: Timestamp
  - updatedAt: Timestamp

inbox/{inboxItemId}
  - userId: string
  - meetingTitle?: string
  - meetingContent: string
  - status: string (pending, processed, accepted, discarded)
  - suggestions: ActionSuggestion[]
  - processedAt?: Timestamp
  - createdAt: Timestamp
  - updatedAt: Timestamp
```

### 6.2 √çndices Necess√°rios

```
priorities:
  - userId + status + quadrant (composite)
  - userId + tags (array-contains)
  - userId + origin

tasks:
  - userId + priorityId + classification
  - userId + priorityId + status
  - userId + status

inbox:
  - userId + status
  - userId + createdAt (desc)
```

---

## 7. Integra√ß√£o com IA

### 7.1 Formato de Comunica√ß√£o: TOON

Toda comunica√ß√£o com modelos de IA (Vertex AI/Gemini) utiliza o formato **TOON** (Token-Oriented Object Notation) ao inv√©s de JSON.

**Vantagens do TOON:**
- Mais compacto e eficiente em tokens
- Leg√≠vel por humanos e modelos de IA
- Schema-aware (estrutura auto-documentada)
- Melhor performance em prompts longos

**Biblioteca:** `@toon-format/toon` (TypeScript)

**Documenta√ß√£o:** https://github.com/toon-format/toon

### 7.2 Prompt para Processamento de Inbox

```
Voc√™ √© um assistente especializado em extrair a√ß√µes e prioridades de resumos de reuni√µes.

Analise o seguinte resumo de reuni√£o e identifique:
1. Prioridades que devem ser criadas (com quadrante Eisenhower)
2. Tarefas espec√≠ficas vinculadas a cada prioridade (com classifica√ß√£o)

Resumo da reuni√£o:
{meetingContent}

Retorne a resposta no formato TOON seguindo esta estrutura:

```toon
suggestions[N]{id,relevantText,actionSummary,priorityTitle,priorityQuadrant,priorityTags,taskTitle,taskClassification,taskIdealDate,taskResponsible}:
  sug1,"Na reuni√£o foi decidido...","Fechar proposta comercial","Fechar proposta Congrega√ß√£o","urgent_and_important","trabalho,comercial","Revisar or√ßamento com financeiro","do",,
  sug2,"Planejamento para julho...","Organizar f√©rias","Planejar f√©rias de julho","important_not_urgent","pessoal,fam√≠lia","Pesquisar hot√©is","schedule","2024-07-01",
  sug3,"Jo√£o ficar√° respons√°vel...","Delegar an√°lise t√©cnica","Implementar nova feature","urgent_not_important","trabalho,desenvolvimento","Analisar viabilidade t√©cnica","delegate",,"Jo√£o Silva"
```

**Nota:** Campos vazios s√£o representados por v√≠rgulas consecutivas (ex: `,,`). Strings com v√≠rgulas internas devem ser escapadas ou usar outro delimitador.

Campos:
- id: identificador √∫nico da sugest√£o
- relevantText: trecho do resumo relevante (opcional)
- actionSummary: resumo curto da a√ß√£o sugerida
- priorityTitle: t√≠tulo da prioridade sugerida
- priorityQuadrant: urgent_and_important | important_not_urgent | urgent_not_important | not_urgent_not_important
- priorityTags: tags separadas por v√≠rgula (opcional)
- taskTitle: t√≠tulo da tarefa sugerida
- taskClassification: do | schedule | delegate | eliminate
- taskIdealDate: data ISO (opcional, apenas para schedule)
- taskResponsible: nome do respons√°vel (opcional, apenas para delegate)
```

### 7.3 Prompt para Chat com Contexto

```
Voc√™ √© um assistente de organiza√ß√£o pessoal que ajuda a gerenciar prioridades e tarefas usando a Matriz de Eisenhower.

Contexto atual do usu√°rio (formato TOON):

Prioridades ativas:
```toon
priorities[N]{id,title,quadrant,status,tags,taskCount}:
  {priorities}
```

Tarefas abertas:
```toon
tasks[N]{id,priorityId,title,classification,status,idealDate,responsible}:
  {tasks}
```

O usu√°rio pode pedir para:
- Criar prioridades e tarefas
- Mover prioridades entre quadrantes
- Reclassificar tarefas
- Listar e revisar itens
- Organizar e repriorizar

Quando precisar retornar dados estruturados (cria√ß√µes, atualiza√ß√µes, listagens), use o formato TOON.

Exemplo de resposta estruturada ao criar prioridade:
```toon
actions[1]{type,priorityId,taskId,message}:
  create_priority,priority123,,Prioridade "Fechar proposta" criada no quadrante Urgente e Importante
```

Exemplo de resposta ao listar prioridades:
```toon
priorities[2]{id,title,quadrant,status,taskCount}:
  priority123,Fechar proposta,urgent_and_important,active,3
  priority456,Planejar f√©rias,important_not_urgent,active,0
```

Sempre confirme a√ß√µes antes de executar a√ß√µes destrutivas.
Ap√≥s executar uma a√ß√£o, confirme o que foi feito de forma clara.

Mensagem do usu√°rio: {message}
```

---

## 8. Regras de Valida√ß√£o T√©cnica

### 8.1 Prioridade

- `title`: obrigat√≥rio, m√≠nimo 3 caracteres, m√°ximo 200
- `quadrant`: obrigat√≥rio, deve ser Q1, Q2, Q3 ou Q4
- `tags`: array de strings, cada tag m√°ximo 50 caracteres
- `displayOrder`: n√∫mero inteiro positivo, √∫nico dentro do quadrante
- Ao mover para outro quadrante, `displayOrder` deve ser recalculado

### 8.2 Tarefa

- `title`: obrigat√≥rio, m√≠nimo 3 caracteres, m√°ximo 200
- `priorityId`: obrigat√≥rio, deve existir e pertencer ao usu√°rio
- `classification`: obrigat√≥rio, deve ser do, schedule, delegate ou eliminate
- `idealDate`: obrigat√≥rio se `classification = 'schedule'`
- `responsible`: obrigat√≥rio se `classification = 'delegate'`
- N√£o √© poss√≠vel criar tarefa em prioridade arquivada

### 8.3 Inbox

- `meetingContent`: obrigat√≥rio, m√≠nimo 10 caracteres
- `meetingTitle`: opcional, m√°ximo 200 caracteres
- Ao processar, status muda de `PENDING` para `PROCESSED`
- Sugest√µes s√≥ podem ser aceitas se status = `PROCESSED`

---

## 9. Tratamento de Erros

### 9.1 C√≥digos HTTP

- `200 OK`: Sucesso
- `201 Created`: Recurso criado
- `400 Bad Request`: Dados inv√°lidos
- `401 Unauthorized`: N√£o autenticado
- `403 Forbidden`: Sem permiss√£o
- `404 Not Found`: Recurso n√£o encontrado
- `409 Conflict`: Conflito (ex.: ordem duplicada)
- `500 Internal Server Error`: Erro do servidor

### 9.2 Formato de Erro

```typescript
{
  statusCode: number;
  message: string;
  error?: string;
  details?: any;
}
```

---

## 10. Ordem de Implementa√ß√£o Sugerida

1. **Depend√™ncias**: Instalar `@toon-format/toon` no backend
2. **Domain**: Entidades `Prioridade` e `Tarefa`
3. **Domain**: Interfaces de reposit√≥rios
4. **Application**: DTOs
5. **Application**: Use Cases b√°sicos (Create, Get, Update)
6. **Infrastructure**: Reposit√≥rios Firestore
7. **Presentation**: Controllers REST
8. **Application**: Use Cases avan√ßados (Move, Reorder, Process Inbox)
9. **Infrastructure**: Integra√ß√£o com IA para Inbox (usando TOON)
10. **Application**: Extens√£o do ChatUseCase para prioridades/tarefas (usando TOON)
11. **Presentation**: Endpoints de relat√≥rios

---

## 11. Considera√ß√µes de Performance

- Usar pagina√ß√£o em listagens grandes (limite padr√£o: 50 itens)
- Cache de prioridades ativas no frontend
- Processamento de Inbox ass√≠ncrono (futuro: fila de processamento)
- √çndices compostos no Firestore para consultas frequentes
- Valida√ß√£o de dados no DTO antes de chegar ao Use Case
- **TOON reduz significativamente o uso de tokens** em comunica√ß√£o com IA (at√© 50% de economia comparado a JSON)

---

## 12. Seguran√ßa

- Todas as rotas protegidas com `AuthGuard('jwt')`
- Valida√ß√£o de `userId` em todos os Use Cases (garantir que recurso pertence ao usu√°rio)
- Valida√ß√£o de entrada com `class-validator` nos DTOs
- Sanitiza√ß√£o de conte√∫do de reuni√µes antes de enviar √† IA
- Rate limiting em endpoints de IA (futuro)
